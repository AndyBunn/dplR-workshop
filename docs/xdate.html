<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 xDate | Using R for Tree-Ring Analysis</title>
  <meta name="description" content="A collection of materials for a workshop using dplR and other things" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 xDate | Using R for Tree-Ring Analysis" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A collection of materials for a workshop using dplR and other things" />
  <meta name="github-repo" content="AndyBunn/dplR-workshop" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 xDate | Using R for Tree-Ring Analysis" />
  
  <meta name="twitter:description" content="A collection of materials for a workshop using dplR and other things" />
  

<meta name="author" content="Andy Bunn, Mikko Korpela" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="using-dplr.html"/>
<link rel="next" href="intro-to-dendro-time-series.html"/>
<script src="libs/header-attrs-2.8/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preamble</a></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction.html"><a href="introduction.html#before-starting"><i class="fa fa-check"></i><b>2.1</b> Before Starting</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="introduction.html"><a href="introduction.html#r"><i class="fa fa-check"></i><b>2.1.1</b> R</a></li>
<li class="chapter" data-level="2.1.2" data-path="introduction.html"><a href="introduction.html#getting-dplr"><i class="fa fa-check"></i><b>2.1.2</b> Getting dplR</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="introduction.html"><a href="introduction.html#getting-help-with-r"><i class="fa fa-check"></i><b>2.2</b> Getting Help with R</a></li>
<li class="chapter" data-level="2.3" data-path="introduction.html"><a href="introduction.html#citing-r-dplr-and-other-packages"><i class="fa fa-check"></i><b>2.3</b> Citing R, dplR, and other packages</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="using-dplr.html"><a href="using-dplr.html"><i class="fa fa-check"></i><b>3</b> Using dplR</a>
<ul>
<li class="chapter" data-level="3.1" data-path="using-dplr.html"><a href="using-dplr.html#what-is-covered"><i class="fa fa-check"></i><b>3.1</b> What is Covered</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="using-dplr.html"><a href="using-dplr.html#load-dplr"><i class="fa fa-check"></i><b>3.1.1</b> Load dplR</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="using-dplr.html"><a href="using-dplr.html#working-with-ring-width-data"><i class="fa fa-check"></i><b>3.2</b> Working with Ring-Width Data</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="using-dplr.html"><a href="using-dplr.html#reading-data"><i class="fa fa-check"></i><b>3.2.1</b> Reading Data</a></li>
<li class="chapter" data-level="3.2.2" data-path="using-dplr.html"><a href="using-dplr.html#describing-and-plotting-ring-width-data"><i class="fa fa-check"></i><b>3.2.2</b> Describing and Plotting Ring-Width Data</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="using-dplr.html"><a href="using-dplr.html#descriptive-statistics"><i class="fa fa-check"></i><b>3.3</b> Descriptive Statistics</a></li>
<li class="chapter" data-level="3.4" data-path="using-dplr.html"><a href="using-dplr.html#detrending"><i class="fa fa-check"></i><b>3.4</b> Detrending</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="using-dplr.html"><a href="using-dplr.html#common-detrending-methods"><i class="fa fa-check"></i><b>3.4.1</b> Common Detrending Methods</a></li>
<li class="chapter" data-level="3.4.2" data-path="using-dplr.html"><a href="using-dplr.html#other-detrending-methods"><i class="fa fa-check"></i><b>3.4.2</b> Other Detrending Methods</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="using-dplr.html"><a href="using-dplr.html#descriptive-statistics-for-detrended-data"><i class="fa fa-check"></i><b>3.5</b> Descriptive Statistics for Detrended Data</a></li>
<li class="chapter" data-level="3.6" data-path="using-dplr.html"><a href="using-dplr.html#building-a-mean-value-chronology"><i class="fa fa-check"></i><b>3.6</b> Building a Mean Value Chronology</a></li>
<li class="chapter" data-level="3.7" data-path="using-dplr.html"><a href="using-dplr.html#conclusion"><i class="fa fa-check"></i><b>3.7</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="xdate.html"><a href="xdate.html"><i class="fa fa-check"></i><b>4</b> xDate</a>
<ul>
<li class="chapter" data-level="4.1" data-path="xdate.html"><a href="xdate.html#introduction-1"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="xdate.html"><a href="xdate.html#using-the-xdater-app"><i class="fa fa-check"></i><b>4.2</b> Using the xDater app</a></li>
<li class="chapter" data-level="4.3" data-path="xdate.html"><a href="xdate.html#crossdating-by-hand-in-dplr"><i class="fa fa-check"></i><b>4.3</b> Crossdating by hand in dplR</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="xdate.html"><a href="xdate.html#load-dplr-1"><i class="fa fa-check"></i><b>4.3.1</b> Load dplR</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="xdate.html"><a href="xdate.html#ruining-a-perfectly-good-data-set"><i class="fa fa-check"></i><b>4.4</b> Ruining a Perfectly Good Data Set</a></li>
<li class="chapter" data-level="4.5" data-path="xdate.html"><a href="xdate.html#series-correlation-by-segment"><i class="fa fa-check"></i><b>4.5</b> Series Correlation by Segment</a></li>
<li class="chapter" data-level="4.6" data-path="xdate.html"><a href="xdate.html#individual-series-correlation"><i class="fa fa-check"></i><b>4.6</b> Individual Series Correlation</a></li>
<li class="chapter" data-level="4.7" data-path="xdate.html"><a href="xdate.html#using-cross-correlation"><i class="fa fa-check"></i><b>4.7</b> Using Cross Correlation</a></li>
<li class="chapter" data-level="4.8" data-path="xdate.html"><a href="xdate.html#visual-crossdating"><i class="fa fa-check"></i><b>4.8</b> Visual Crossdating</a></li>
<li class="chapter" data-level="4.9" data-path="xdate.html"><a href="xdate.html#conclusion-1"><i class="fa fa-check"></i><b>4.9</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="intro-to-dendro-time-series.html"><a href="intro-to-dendro-time-series.html"><i class="fa fa-check"></i><b>5</b> Intro to dendro time-series</a>
<ul>
<li class="chapter" data-level="5.1" data-path="intro-to-dendro-time-series.html"><a href="intro-to-dendro-time-series.html#introduction-2"><i class="fa fa-check"></i><b>5.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="intro-to-dendro-time-series.html"><a href="intro-to-dendro-time-series.html#load-libraries"><i class="fa fa-check"></i><b>5.1.1</b> Load libraries</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="intro-to-dendro-time-series.html"><a href="intro-to-dendro-time-series.html#data-sets"><i class="fa fa-check"></i><b>5.2</b> Data Sets</a></li>
<li class="chapter" data-level="5.3" data-path="intro-to-dendro-time-series.html"><a href="intro-to-dendro-time-series.html#smoothing"><i class="fa fa-check"></i><b>5.3</b> Smoothing</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="intro-to-dendro-time-series.html"><a href="intro-to-dendro-time-series.html#moving-running-average"><i class="fa fa-check"></i><b>5.3.1</b> Moving (running) average</a></li>
<li class="chapter" data-level="5.3.2" data-path="intro-to-dendro-time-series.html"><a href="intro-to-dendro-time-series.html#hanning"><i class="fa fa-check"></i><b>5.3.2</b> Hanning</a></li>
<li class="chapter" data-level="5.3.3" data-path="intro-to-dendro-time-series.html"><a href="intro-to-dendro-time-series.html#splines"><i class="fa fa-check"></i><b>5.3.3</b> Splines</a></li>
<li class="chapter" data-level="5.3.4" data-path="intro-to-dendro-time-series.html"><a href="intro-to-dendro-time-series.html#loess"><i class="fa fa-check"></i><b>5.3.4</b> Loess</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="intro-to-dendro-time-series.html"><a href="intro-to-dendro-time-series.html#characterizing-temporal-structure"><i class="fa fa-check"></i><b>5.4</b> Characterizing Temporal Structure</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="intro-to-dendro-time-series.html"><a href="intro-to-dendro-time-series.html#acf-and-pacf"><i class="fa fa-check"></i><b>5.4.1</b> ACF and PACF</a></li>
<li class="chapter" data-level="5.4.2" data-path="intro-to-dendro-time-series.html"><a href="intro-to-dendro-time-series.html#ar-and-arma"><i class="fa fa-check"></i><b>5.4.2</b> AR and ARMA</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="intro-to-dendro-time-series.html"><a href="intro-to-dendro-time-series.html#frequency-domain"><i class="fa fa-check"></i><b>5.5</b> Frequency Domain</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="intro-to-dendro-time-series.html"><a href="intro-to-dendro-time-series.html#power-via-spectral-analysis-and-wavelets"><i class="fa fa-check"></i><b>5.5.1</b> Power via Spectral Analysis and Wavelets</a></li>
<li class="chapter" data-level="5.5.2" data-path="intro-to-dendro-time-series.html"><a href="intro-to-dendro-time-series.html#extracting-signals"><i class="fa fa-check"></i><b>5.5.2</b> Extracting signals</a></li>
<li class="chapter" data-level="5.5.3" data-path="intro-to-dendro-time-series.html"><a href="intro-to-dendro-time-series.html#high-pass-low-pass-and-bandpass-filtering"><i class="fa fa-check"></i><b>5.5.3</b> High-pass, low-pass, and bandpass filtering</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>6</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Using R for Tree-Ring Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="xdate" class="section level1" number="4">
<h1><span class="header-section-number">Chapter 4</span> xDate</h1>
<p>In this vignette we cover basic crossdating techniques in <code>dplR</code> by deliberately
misdating one of the series in a well-dated set of ring widths and tracking
down the dating error. As with any dating enterprise, statistical
crossdating is merely a tool and users should always rely on the wood to
accurately date tree-ring data.</p>
<div id="introduction-1" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Introduction</h2>
<p>This gives an introduction of some of the crossdating functions in
dplR. This is essentially a rehashing of <span class="citation"><a href="references.html#ref-Bunn2010" role="doc-biblioref">Bunn</a> (<a href="references.html#ref-Bunn2010" role="doc-biblioref">2010</a>)</span>. Please
cite that paper if you use dplR for crossdating. There is more detailed
information on all these functions in the help files.</p>
</div>
<div id="using-the-xdater-app" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Using the xDater app</h2>
<p>Below I’ll walk through using <code>dplR</code>’s crossdating functions on the command line. I’ve also built a Shiny app for doing crossdating in an interactive graphical workflow. This is definitely still in development and I plan on cleaning it up some soon. It’s meant to mimic a lot of the look and feel of COFECHA since that’s what most folks are used to using. Here it is:</p>
<p><a href="https://andybunn.shinyapps.io/xDateR/">andybunn.shinyapps.io/xDateR/</a></p>
<p>While the xDater app is cool, the <a href="https://ringdater.shinyapps.io/launcher/">ringdater app</a> from David Reynolds, David Edge &amp; Bryan Black is also very cool. Check that out too.</p>
</div>
<div id="crossdating-by-hand-in-dplr" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Crossdating by hand in dplR</h2>
<p>Here is a walk through of using <code>dplR</code> for crossdating on the command line.</p>
<div id="load-dplr-1" class="section level3" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Load dplR</h3>
<p>We will be usinf <code>dplR</code> in here. Load it:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="xdate.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplR)</span></code></pre></div>
</div>
</div>
<div id="ruining-a-perfectly-good-data-set" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Ruining a Perfectly Good Data Set</h2>
<p>Throughout this vignette we will use the on-board data set <code>co021</code> which gives the raw ring widths for Douglas fir <em>Pseudotsuga menziesii</em> at Mesa Verde in Colorado, USA. There are 35 series spanning 788 years.</p>
<p>We will rename the <code>co021</code> object to <code>dat</code> because we are going to mess around with it and it seems like good practice to rename it.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="xdate.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(co021)</span>
<span id="cb52-2"><a href="xdate.html#cb52-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> co021</span>
<span id="cb52-3"><a href="xdate.html#cb52-3" aria-hidden="true" tabindex="-1"></a>dat.sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(dat)</span>
<span id="cb52-4"><a href="xdate.html#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(dat.sum<span class="sc">$</span>year)</span></code></pre></div>
<pre><code>## [1] 564.9</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="xdate.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(dat.sum<span class="sc">$</span>stdev)</span></code></pre></div>
<pre><code>## [1] 0.3232</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="xdate.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(dat.sum<span class="sc">$</span>median)</span></code></pre></div>
<pre><code>## [1] 0.3211</code></pre>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="xdate.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(dat.sum<span class="sc">$</span>ar1)</span></code></pre></div>
<pre><code>## [1] 0.6038</code></pre>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="xdate.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">interseries.cor</span>(dat)[, <span class="dv">1</span>])</span></code></pre></div>
<pre><code>## [1] 0.8478</code></pre>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="xdate.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat, <span class="at">plot.type=</span><span class="st">&quot;spag&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<p>We can see that this is a beautifully sensitive collection with long segment lengths, high standard deviation (relative to ring widths), large first-order autocorrelation, and a high mean interseries correlation (<span class="math inline">\(\mathrm{r}\approx 0.84\)</span>).</p>
<p>To demonstrate how crossdating works in <code>dplR</code>, we will take this perfectly
lovely data set and corrupt the dating of one of the series. By doing so we
will be able to reenact one of the most common tasks of the dendrochronologist:
tracking down a misdated core. Here we will take a random series and remove
one of the years of growth. This simulates a missing ring in the series. We will
pick a random year in the core to give us a bit of a challenge in finding it.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="xdate.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4576</span>)</span>
<span id="cb63-2"><a href="xdate.html#cb63-2" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">x=</span><span class="fu">nrow</span>(dat), <span class="at">size=</span><span class="dv">1</span>)</span>
<span id="cb63-3"><a href="xdate.html#cb63-3" aria-hidden="true" tabindex="-1"></a>j <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">x=</span><span class="fu">ncol</span>(dat), <span class="at">size=</span><span class="dv">1</span>)</span>
<span id="cb63-4"><a href="xdate.html#cb63-4" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> dat[, j]</span>
<span id="cb63-5"><a href="xdate.html#cb63-5" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">NA</span>, tmp[<span class="sc">-</span>i])</span>
<span id="cb63-6"><a href="xdate.html#cb63-6" aria-hidden="true" tabindex="-1"></a>dat[, j] <span class="ot">&lt;-</span> tmp</span></code></pre></div>
<p>We have now deleted the <span class="math inline">\(i^{th}\)</span> observation from the <span class="math inline">\(j^{th}\)</span> core while making sure that <code>dat</code> still has the appropriate numbers of rows. By sticking the NA at the
start of the series it is as if we missed a ring while measuring.</p>
</div>
<div id="series-correlation-by-segment" class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> Series Correlation by Segment</h2>
<p>The primary function for looking the crossdating of a tree-ring data set in
dplR is <code>corr.rwl.seg</code>. This function looks at the correlation between
each tree-ring series and a master chronology built from all the other series
in the rwl object (leave-one-out principle). These correlations are calculated
on overlapping segments (e.g., 50-year segments would be overlapped by
25 years). By default, each of the series is filtered to remove low-frequency
variation prior to the correlation analysis. The help file has abundant
details. Here we will look at overlapping 60 year segments. A plot is
produced by default with <code>corr.rwl.seg</code>.</p>
<p>In the <code>corr.rwl.seg</code> plot, each segment of each series
is shown and colored by its correlation with the master. Each series is
represented by two courses of lines with the bottom course adhering to the
bottom axis timeline and the top course matching the upper axis timeline.
Segments are colored according to the strength of the correlation between
that segment and the master chronology. Blue correlates well (p-values less
or equal to the user-set critical value) while potential dating problems
are indicated by the red segments (p-values greater than the user-set
critical value). Green lines show segments that do not completely overlap
the time period and thus have no correlations calculated. Our modified data
set indicates one series with dating problems.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="xdate.html#cb64-1" aria-hidden="true" tabindex="-1"></a>rwl<span class="fl">.60</span> <span class="ot">&lt;-</span> <span class="fu">corr.rwl.seg</span>(dat, <span class="at">seg.length=</span><span class="dv">60</span>, <span class="at">pcrit=</span><span class="fl">0.01</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<p>In this figure, each 60-year segment of each series in the modified Mesa
Verde data set is shown and colored by its correlation with the master.
Our modified data set indicates one series with dating problems.</p>
</div>
<div id="individual-series-correlation" class="section level2" number="4.6">
<h2><span class="header-section-number">4.6</span> Individual Series Correlation</h2>
<p>The low correlation between series <code>643114</code> and the master indicates a dating
problem. Now that we suspect a dating problem, let us take a closer look at this problem child. The figure above shows that series <code>643114</code> begins to lose correlation with the master at the end of the 19th century.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="xdate.html#cb65-1" aria-hidden="true" tabindex="-1"></a>seg<span class="fl">.60</span> <span class="ot">&lt;-</span> <span class="fu">corr.series.seg</span>(<span class="at">rwl=</span>dat, <span class="at">series=</span><span class="st">&quot;643114&quot;</span>,</span>
<span id="cb65-2"><a href="xdate.html#cb65-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">seg.length=</span><span class="dv">60</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<p>Correlations between series <code>643114</code> and the master chronology are
shown with horizontal lines according (60-year segments lagged by 30 years).
A centered running correlation with a length of 60 years complements the
segment correlations. The critical level is shown with a dashed line.</p>
</div>
<div id="using-cross-correlation" class="section level2" number="4.7">
<h2><span class="header-section-number">4.7</span> Using Cross Correlation</h2>
<p>This figure strongly indicates that the dating in the series <code>643114</code>
begins to deteriorate between 1850 and 1910. We can create a window (<code>win</code>) of years
and subset <code>dat</code> to the window if years we want to look at. Then we can look more closely at this time period and compute a cross-correlation function to look at lagged correlations to see if we can spot the dating problem.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="xdate.html#cb66-1" aria-hidden="true" tabindex="-1"></a>win <span class="ot">&lt;-</span> <span class="dv">1800</span><span class="sc">:</span><span class="dv">1960</span></span>
<span id="cb66-2"><a href="xdate.html#cb66-2" aria-hidden="true" tabindex="-1"></a>dat.yrs <span class="ot">&lt;-</span> <span class="fu">time</span>(dat)</span>
<span id="cb66-3"><a href="xdate.html#cb66-3" aria-hidden="true" tabindex="-1"></a>dat.win <span class="ot">&lt;-</span> <span class="fu">subset</span>(dat,dat.yrs <span class="sc">%in%</span> win)</span>
<span id="cb66-4"><a href="xdate.html#cb66-4" aria-hidden="true" tabindex="-1"></a>ccf<span class="fl">.30</span> <span class="ot">&lt;-</span> <span class="fu">ccf.series.rwl</span>(<span class="at">rwl=</span>dat.win, <span class="at">series=</span><span class="st">&quot;643114&quot;</span>, </span>
<span id="cb66-5"><a href="xdate.html#cb66-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">seg.length=</span><span class="dv">30</span>, <span class="at">bin.floor=</span><span class="dv">50</span>)</span></code></pre></div>
<pre><code>## NB: With series.x = FALSE (default), negative lags indicate missing rings in series</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<p>Cross-correlations between series <code>643114</code> and the master
chronology are shown for each segment (30-year segments lagged by 15 years).
The series correlates well at lag 0 until the 1865–1894 bin and then at
lag +1 prior to 1865.</p>
<p>This figure shows that 1865 to 1894 is the misdated part of
this series. The lag of +1 over a lag of 0 indicates that the series
<code>643114</code> is missing a ring as it better correlates to the master
chronology with a one-year offset.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<p>Using a smaller time window and shorter correlation segments we
can try to further isolate the switch from correlation at lag 0 to lag +1.
We will, of course, have to be very careful about using such short segments
for correlation and be ready to adjust our expectations accordingly.
Fortunately, in this case the trees are so exquisitely sensitive that we can
look at 20-year segments with some confidence.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="xdate.html#cb68-1" aria-hidden="true" tabindex="-1"></a>win <span class="ot">&lt;-</span> <span class="dv">1850</span><span class="sc">:</span><span class="dv">1900</span></span>
<span id="cb68-2"><a href="xdate.html#cb68-2" aria-hidden="true" tabindex="-1"></a>dat.win <span class="ot">&lt;-</span> <span class="fu">subset</span>(dat,dat.yrs <span class="sc">%in%</span> win)</span>
<span id="cb68-3"><a href="xdate.html#cb68-3" aria-hidden="true" tabindex="-1"></a>ccf<span class="fl">.20</span> <span class="ot">&lt;-</span> <span class="fu">ccf.series.rwl</span>(<span class="at">rwl=</span>dat.win, <span class="at">series=</span><span class="st">&quot;643114&quot;</span>,</span>
<span id="cb68-4"><a href="xdate.html#cb68-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">seg.length=</span><span class="dv">20</span>, <span class="at">bin.floor=</span><span class="dv">0</span>)</span></code></pre></div>
<pre><code>## NB: With series.x = FALSE (default), negative lags indicate missing rings in series</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<p>Cross-correlations between series `643114’ and the master
chronology at 20-year segments lagged by 10 years over 1850–1900.</p>
<p>By 1879 the correlation between series <code>643114</code> and the master is solidly at
lag +1. The 1870 to 1889 correlation is marginal
while the dating at 1880–1899 seems accurate (lag 0). This suggests that
the dating error is between 1879 and 1889.</p>
<p>At this point we could repeat the cross-correlation using even more carefuly to get even closer to the bad year if we wanted to. But at this point going and looking at the wood in that neighborhood would be the best option. Statistics only gets you so far.</p>
</div>
<div id="visual-crossdating" class="section level2" number="4.8">
<h2><span class="header-section-number">4.8</span> Visual Crossdating</h2>
<p>We have strong inference now that series <code>643114</code> is misdated somewhere in a ten
year period around 1885. One final tool that <code>dplR</code> has is the ability to combine
the visual style of crossdating using skeleton plots with the statistical
approach of cross-correlation analysis. The <code>skel.ccf.plot</code> function does
just this. Here we make a skeleton plot from the 40-year period around the
suspected dating error (1885):</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="xdate.html#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xskel.ccf.plot</span>(<span class="at">rwl=</span>dat, <span class="at">series=</span><span class="st">&quot;643114&quot;</span>,</span>
<span id="cb70-2"><a href="xdate.html#cb70-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">win.start=</span><span class="dv">1865</span>, <span class="at">win.width=</span><span class="dv">40</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<p>The top panel shows the normalized values for the master chronology
(bottom half) and the series <code>643114</code> (top half) in green. The values are
relative. Similarly, the black lines are a skeleton plot for the master and
series with the marker years annotated for the master on the bottom axis and
series <code>643114</code> on the top. The text at the top of the figure gives the
correlation between the series and master (green bars) as well as the percentage
of agreement between the skeleton bars for the series and master. The bottom
panels show cross correlations for the first half (left) and second half of
the time series. In this case, the early period (1865–1884) shows a mismatch
of the skeleton plot by one year coupled with a strong lag +1 correlation.</p>
<p>At this point the analyst would go to the wood and take a good look at the
core and see what they could find out. There are more heroic efforts that
one could go to to figure out exactly where the dating problem might be
but nothing ever takes the place of looking at the sample!</p>
</div>
<div id="conclusion-1" class="section level2" number="4.9">
<h2><span class="header-section-number">4.9</span> Conclusion</h2>
<p>We have strong inference now that series <code>643114</code> is misdated somewhere in a ten
year period around 1885. We have still not revealed whether this is correct
or not. Let us look at the values for <code>i</code> and <code>j</code> and see how we did:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="xdate.html#cb71-1" aria-hidden="true" tabindex="-1"></a>j</span></code></pre></div>
<pre><code>## [1] 13</code></pre>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="xdate.html#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(co021)[j]</span></code></pre></div>
<pre><code>## [1] &quot;643143&quot;</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="xdate.html#cb75-1" aria-hidden="true" tabindex="-1"></a>i</span></code></pre></div>
<pre><code>## [1] 557</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="xdate.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(co021)[i]</span></code></pre></div>
<pre><code>## [1] &quot;1732&quot;</code></pre>
<p>Our sleuthing indicated that our dating error was around the year 1885. In
fact, <code>i</code> was the year 1884.</p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>As of dplR version 1.60,
the cross correlations in <code>ccf.series.rwl</code> are calculated calling
<code>ccf(x=series, y=master, lag.max=lag.max, plot=FALSE)</code>. Note that
prior to dplR version 1.60, the <code>master</code> was set as <code>x</code> and
the <code>series</code> as <code>y</code>. This was changed to be more in line with
user expectations so that a missing ring in a series produces a positive
lag in the plot rather than a negative lag. This structure of this call
does put the plots at odds with Figure 3 in <span class="citation"><a href="references.html#ref-Bunn2010" role="doc-biblioref">Bunn</a> (<a href="references.html#ref-Bunn2010" role="doc-biblioref">2010</a>)</span> which is
unfortunate.<a href="xdate.html#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="using-dplr.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="intro-to-dendro-time-series.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
